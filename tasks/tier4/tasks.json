{
  "tier": 4,
  "name": "Prediction Models - Riley Methods & Validation",
  "description": "Sample size for developing and validating clinical prediction models using Riley criteria (pmsampsize) and external validation (pmvalsampsize)",
  "tasks": [
    {
      "id": "t4-binary-001",
      "template": "riley_binary",
      "difficulty": "basic",
      "question": "We are developing a logistic regression model to predict the presence of liver cirrhosis. We have 24 candidate predictors and anticipate the outcome prevalence will be 0.174 (around 17%). We have estimated R^2_CS of 0.288 using Nagelkerke formula. What is the minimum sample size?",
      "expected_template": "riley_binary",
      "ground_truth": {
        "sample_size": 662,
        "events": 115,
        "predictors": 24,
        "prevalence": 0.174,
        "cs_rsquared": 0.288,
        "max_shrinkage": 0.9,
        "criteria": "riley_binary"
      },
      "tolerance": {
        "sample_size": 33,
        "events": 6
      },
      "source": "pmsampsize CRAN vignette - Example 1 (Cirrhosis prediction)",
      "reference_code": "library(pmsampsize)\npmsampsize(type = 'b', csrsquared = 0.288, parameters = 24, prevalence = 0.174)\n# Results: minimum sample size = 662, 115 events required"
    },
    {
      "id": "t4-binary-002",
      "template": "riley_binary",
      "difficulty": "basic",
      "question": "We are building a binary prediction model for hospital readmission. We have 24 candidate predictors, outcome prevalence of 0.174, and the anticipated Nagelkerke R-squared is 0.36. Using Riley criteria with pmsampsize(type='b', nagrsquared=0.36, parameters=24, prevalence=0.174), what sample size is needed?",
      "expected_template": "riley_binary",
      "ground_truth": {
        "sample_size": 870,
        "events": 152,
        "predictors": 24,
        "prevalence": 0.174,
        "nagelkerke_rsquared": 0.36,
        "max_shrinkage": 0.9,
        "criteria": "riley_binary"
      },
      "tolerance": {
        "sample_size": 44,
        "events": 8
      },
      "source": "pmsampsize (R-validated 2026-02-01)",
      "reference_code": "library(pmsampsize)\npmsampsize(type='b', nagrsquared=0.36, parameters=24, prevalence=0.174)\n# N=870, events=152. Must use nagrsquared parameter for Nagelkerke R-squared."
    },
    {
      "id": "t4-binary-003",
      "template": "riley_binary",
      "difficulty": "intermediate",
      "question": "Rare outcome prediction: postoperative complication rate 5%, 12 predictors planned, expected C-statistic 0.80, target shrinkage factor 0.90. Use pmsampsize(type='b', parameters=12, prevalence=0.05, cstatistic=0.80) from the pmsampsize R package to compute the Riley criteria sample size. What is the required total sample size?",
      "expected_template": "riley_binary",
      "ground_truth": {
        "sample_size": 1679,
        "events": 84,
        "predictors": 12,
        "prevalence": 0.05,
        "c_statistic": 0.8,
        "max_shrinkage": 0.9,
        "criteria": "riley_binary"
      },
      "tolerance": {
        "sample_size": 84,
        "events": 4
      },
      "source": "pmsampsize package (R-validated 2026-01-29)",
      "reference_code": "library(pmsampsize)\npmsampsize(type='b', parameters=12, prevalence=0.05, cstatistic=0.80)\n# Sample size = 1679, Events = 84"
    },
    {
      "id": "t4-binary-004",
      "template": "riley_binary",
      "difficulty": "advanced",
      "question": "High-dimensional model: 25 predictors (after variable selection), prevalence 12%, C-statistic target 0.82. Setting shrinkage target to 0.95 (more conservative). Use pmsampsize(type='b', parameters=25, prevalence=0.12, cstatistic=0.82, shrinkage=0.95). What is the required sample size?",
      "expected_template": "riley_binary",
      "ground_truth": {
        "sample_size": 2977,
        "events": 357,
        "predictors": 25,
        "prevalence": 0.12,
        "c_statistic": 0.82,
        "max_shrinkage": 0.95,
        "criteria": "riley_binary"
      },
      "tolerance": {
        "sample_size": 149,
        "events": 18
      },
      "source": "pmsampsize::pmsampsize (R-validated 2026-01-28)",
      "reference_code": "library(pmsampsize)\npmsampsize(type='b', parameters=25, prevalence=0.12, cstatistic=0.82, shrinkage=0.95)\n# Criteria 1 (shrinkage): 2977, EPP=14.29"
    },
    {
      "id": "t4-binary-005",
      "template": "riley_binary",
      "difficulty": "intermediate",
      "question": "Very rare outcome prediction model development: 8 candidate predictors, outcome prevalence 3%, anticipated C-statistic 0.85. Use pmsampsize(type='b', parameters=8, prevalence=0.03, cstatistic=0.85). What is the minimum sample size?",
      "expected_template": "riley_binary",
      "ground_truth": {
        "sample_size": 1214,
        "events": 37,
        "predictors": 8,
        "prevalence": 0.03,
        "c_statistic": 0.85,
        "max_shrinkage": 0.9,
        "criteria": "riley_binary"
      },
      "tolerance": {
        "sample_size": 61,
        "events": 3
      },
      "source": "pmsampsize (R-validated 2026-02-01)",
      "reference_code": "library(pmsampsize)\npmsampsize(type='b', parameters=8, prevalence=0.03, cstatistic=0.85)\n# N=1214, events=37, EPP=4.55. Shrinkage criterion dominates."
    },
    {
      "id": "t4-surv-001",
      "template": "riley_survival",
      "difficulty": "basic",
      "question": "We are developing a survival prediction model for time to recurrent venous thromboembolism (VTE). We have 30 candidate predictors. The overall event rate is 0.065, and we anticipate R\u00b2_CS of 0.051. The timepoint of interest is 2 years with mean follow-up of 2.07 years. What minimum sample size is needed?",
      "expected_template": "riley_survival",
      "ground_truth": {
        "sample_size": 5143,
        "events": 692,
        "predictors": 30,
        "event_rate": 0.065,
        "r2_cs": 0.051,
        "timepoint": 2,
        "mean_followup": 2.07,
        "max_shrinkage": 0.9,
        "criteria": "riley_survival"
      },
      "tolerance": {
        "sample_size": 257,
        "events": 35
      },
      "source": "pmsampsize CRAN vignette - Example 3 (VTE survival model)",
      "reference_code": "library(pmsampsize)\npmsampsize(type='s', csrsquared=0.051, parameters=30, rate=0.065, timepoint=2, meanfup=2.07)\n# N=5143, events=692"
    },
    {
      "id": "t4-surv-002",
      "template": "riley_survival",
      "difficulty": "basic",
      "question": "Cancer prognosis model: 6 predictors, 5-year mortality 40%, Cox-Snell R\u00b2_CS = 0.25, timepoint of interest 5 years, mean follow-up 3 years. Use pmsampsize(type='s', parameters=6, rate=0.40, csrsquared=0.25, timepoint=5, meanfup=3). What is the minimum sample size?",
      "expected_template": "riley_survival",
      "ground_truth": {
        "sample_size": 185,
        "events": 74,
        "predictors": 6,
        "event_rate": 0.4,
        "r2_cs": 0.25,
        "timepoint": 5,
        "mean_followup": 3,
        "max_shrinkage": 0.9,
        "criteria": "riley_survival"
      },
      "tolerance": {
        "sample_size": 9,
        "events": 4
      },
      "source": "pmsampsize::pmsampsize (R-validated 2026-01-28)",
      "reference_code": "library(pmsampsize)\npmsampsize(type='s', parameters=6, rate=0.40, csrsquared=0.25, timepoint=5, meanfup=3)\n# N=185, events=74"
    },
    {
      "id": "t4-surv-003",
      "template": "riley_survival",
      "difficulty": "intermediate",
      "question": "Cardiovascular risk prediction: 12 predictors, 10-year event rate 15%, R\u00b2_CS = 0.15, mean follow-up 6 years. Riley sample size?",
      "expected_template": "riley_survival",
      "ground_truth": {
        "sample_size": 659,
        "events": 593,
        "predictors": 12,
        "event_rate": 0.15,
        "r2_cs": 0.15,
        "timepoint": 10,
        "mean_followup": 6,
        "max_shrinkage": 0.9,
        "criteria": "riley_survival"
      },
      "tolerance": {
        "sample_size": 33,
        "events": 30
      },
      "source": "pmsampsize package (R-validated 2026-01-29)",
      "reference_code": "library(pmsampsize)\npmsampsize(type='s', parameters=12, rate=0.15, csrsquared=0.15, timepoint=10, meanfup=6)\n# N=659, events=593"
    },
    {
      "id": "t4-surv-004",
      "template": "riley_survival",
      "difficulty": "advanced",
      "question": "Competing risks prediction: primary event rate 20%, 10 predictors for primary event model, R²_CS = 0.18. Use standard pmsampsize for the primary event: pmsampsize(type='s', parameters=10, rate=0.20, csrsquared=0.18, timepoint=5, meanfup=3). Report the exact minimum sample size from pmsampsize output (do not add adjustments for dropout or loss to follow-up).",
      "expected_template": "riley_survival",
      "ground_truth": {
        "sample_size": 449,
        "events": 90,
        "predictors": 10,
        "primary_rate": 0.2,
        "r2_cs": 0.18,
        "max_shrinkage": 0.9,
        "criteria": "riley_survival"
      },
      "tolerance": {
        "sample_size": 22,
        "events": 5
      },
      "source": "pmsampsize package (R-validated 2026-01-29)",
      "reference_code": "library(pmsampsize)\npmsampsize(type='s', parameters=10, rate=0.20, csrsquared=0.18, timepoint=5, meanfup=3)\n# N=449, events=90"
    },
    {
      "id": "t4-surv-005",
      "template": "riley_survival",
      "difficulty": "intermediate",
      "question": "Survival model development with high event rate: 15 predictors, event rate 40%, Cox-Snell R\u00b2_CS = 0.20, timepoint 3 years, mean follow-up 2.5 years. Use pmsampsize(type='s', parameters=15, rate=0.40, csrsquared=0.20, timepoint=3, meanfup=2.5). What is the minimum sample size?",
      "expected_template": "riley_survival",
      "ground_truth": {
        "sample_size": 597,
        "events": 597,
        "predictors": 15,
        "event_rate": 0.4,
        "r2_cs": 0.20,
        "timepoint": 3,
        "mean_followup": 2.5,
        "max_shrinkage": 0.9,
        "criteria": "riley_survival"
      },
      "tolerance": {
        "sample_size": 30,
        "events": 30
      },
      "source": "pmsampsize (R-validated 2026-02-01)",
      "reference_code": "library(pmsampsize)\npmsampsize(type='s', parameters=15, rate=0.40, csrsquared=0.20, timepoint=3, meanfup=2.5)\n# N=597, events=597, person-time=1492.5"
    },
    {
      "id": "t4-cont-001",
      "template": "riley_continuous",
      "difficulty": "basic",
      "question": "We are developing a linear regression model to predict fat-free mass in children from 25 candidate predictors. We anticipate an R\u00b2 of 0.2. The intercept is 1.9 and the standard deviation of the outcome is 0.6. What minimum sample size is needed?",
      "expected_template": "riley_continuous",
      "ground_truth": {
        "sample_size": 918,
        "predictors": 25,
        "r2": 0.2,
        "intercept": 1.9,
        "sd": 0.6,
        "max_shrinkage": 0.9,
        "criteria": "riley_continuous"
      },
      "tolerance": {
        "sample_size": 46
      },
      "source": "pmsampsize CRAN vignette - Example 4 (Fat-free mass in children)",
      "reference_code": "library(pmsampsize)\npmsampsize(type='c', rsquared=0.2, parameters=25, intercept=1.9, sd=0.6)\n# N=918"
    },
    {
      "id": "t4-cont-002",
      "template": "riley_continuous",
      "difficulty": "basic",
      "question": "Predicting blood pressure: 5 predictors, R\u00b2 = 0.30 expected, outcome mean (intercept) = 120 mmHg, outcome SD = 15 mmHg. Use pmsampsize(type='c', parameters=5, rsquared=0.30, intercept=120, sd=15). What is the Riley minimum sample size?",
      "expected_template": "riley_continuous",
      "ground_truth": {
        "sample_size": 239,
        "predictors": 5,
        "r2": 0.3,
        "intercept": 120,
        "sd": 15,
        "max_shrinkage": 0.9,
        "criteria": "riley_continuous"
      },
      "tolerance": {
        "sample_size": 12
      },
      "source": "pmsampsize::pmsampsize (R-validated 2026-01-28)",
      "reference_code": "library(pmsampsize)\npmsampsize(type='c', parameters=5, rsquared=0.30, intercept=120, sd=15)\n# N=239"
    },
    {
      "id": "t4-cont-003",
      "template": "riley_continuous",
      "difficulty": "intermediate",
      "question": "Complex continuous prediction: 15 predictors, modest R\u00b2 = 0.15. Need shrinkage < 5% (more conservative). What n?",
      "expected_template": "riley_continuous",
      "ground_truth": {
        "sample_size": 1508,
        "predictors": 15,
        "r2": 0.15,
        "max_shrinkage": 0.95,
        "criteria": "riley_continuous"
      },
      "tolerance": {
        "sample_size": 75
      },
      "source": "pmsampsize package (R-validated 2026-01-29)",
      "reference_code": "library(pmsampsize)\npmsampsize(type='c', parameters=15, rsquared=0.15, shrinkage=0.95, intercept=0, sd=1)\n# N=1508"
    },
    {
      "id": "t4-cont-004",
      "template": "riley_continuous",
      "difficulty": "advanced",
      "question": "High-dimensional continuous: 30 predictors after LASSO selection, R\u00b2 = 0.35. Standardized outcome (intercept=0, SD=1). Standard Riley criteria (shrinkage 0.90). Use pmsampsize(type='c', parameters=30, rsquared=0.35, intercept=0, sd=1). Sample size?",
      "expected_template": "riley_continuous",
      "ground_truth": {
        "sample_size": 580,
        "predictors": 30,
        "r2": 0.35,
        "intercept": 0,
        "sd": 1,
        "max_shrinkage": 0.9,
        "criteria": "riley_continuous"
      },
      "tolerance": {
        "sample_size": 29
      },
      "source": "pmsampsize::pmsampsize (R-validated 2026-01-28)",
      "reference_code": "library(pmsampsize)\npmsampsize(type='c', parameters=30, rsquared=0.35, intercept=0, sd=1)\n# N=580"
    },
    {
      "id": "t4-valid-001",
      "template": "external_validation",
      "difficulty": "basic",
      "question": "External validation of a DVT diagnostic prediction model. The linear predictor follows a normal distribution with mean = -1.75 and SD = 2.16 (note: SD, not variance). The expected C-statistic is 0.82, calibration slope is 1 (well-calibrated), and outcome prevalence is 0.22. We want the 95% CI width for C-statistic \u2264 0.10, calibration slope CI width \u2264 0.20, and O/E ratio CI width \u2264 0.20. Use the pmvalsampsize R package: pmvalsampsize(type='b', prevalence=0.22, cstatistic=0.82, lpnormal=c(-1.75, 2.16), cstatciwidth=0.1, csciwidth=0.2, oeciwidth=0.2). What is the minimum total sample size?",
      "expected_template": "riley_validation",
      "ground_truth": {
        "sample_size": 1832,
        "events": 403,
        "prevalence": 0.22,
        "cstatistic": 0.82,
        "cstat_ciwidth": 0.10,
        "calslope_ciwidth": 0.20,
        "oe_ciwidth": 0.20,
        "binding_criterion": "calibration_slope",
        "criteria": "pmvalsampsize_binary"
      },
      "tolerance": {
        "sample_size": 92,
        "events": 20
      },
      "source": "pmvalsampsize (R-validated 2026-02-06)",
      "reference_code": "library(pmvalsampsize)\n# lpnormal takes (mean, SD) — here SD=2.16\npmvalsampsize(type='b', prevalence=0.22, cstatistic=0.82, lpnormal=c(-1.75, 2.16), cstatciwidth=0.1, csciwidth=0.2, oeciwidth=0.2)\n# Criteria 1 (O/E): 1364, Criteria 2 (C-slope): 1832, Criteria 3 (C-stat): 400\n# Final: 1832 (calibration slope binds)"
    },
    {
      "id": "t4-valid-002",
      "template": "external_validation",
      "difficulty": "intermediate",
      "question": "External validation of a binary prediction model for stroke risk. The expected C-statistic in the new population is 0.75. Outcome prevalence is 15%. The linear predictor follows a normal distribution with mean = -2.0 and SD = 1.44 (note: SD, not variance). Target precision: C-statistic CI width \u2264 0.08, calibration slope CI width \u2264 0.30, O/E ratio CI width \u2264 0.30. Use pmvalsampsize(type='b', prevalence=0.15, cstatistic=0.75, lpnormal=c(-2.0, 1.44), cstatciwidth=0.08, csciwidth=0.3, oeciwidth=0.3). What is the minimum sample size?",
      "expected_template": "riley_validation",
      "ground_truth": {
        "sample_size": 1183,
        "events": 178,
        "prevalence": 0.15,
        "cstatistic": 0.75,
        "cstat_ciwidth": 0.08,
        "calslope_ciwidth": 0.30,
        "oe_ciwidth": 0.30,
        "binding_criterion": "calibration_slope",
        "criteria": "pmvalsampsize_binary"
      },
      "tolerance": {
        "sample_size": 59,
        "events": 9
      },
      "source": "pmvalsampsize (R-validated 2026-02-01)",
      "reference_code": "library(pmvalsampsize)\n# lpnormal takes (mean, SD) — here SD=1.44\npmvalsampsize(type='b', prevalence=0.15, cstatistic=0.75, lpnormal=c(-2.0, 1.44), cstatciwidth=0.08, csciwidth=0.3, oeciwidth=0.3)\n# Criteria 1 (O/E): 974, Criteria 2 (C-slope): 1183, Criteria 3 (C-stat): 1111\n# Final: 1183 (calibration slope binds)"
    },
    {
      "id": "t4-valid-003",
      "template": "external_validation",
      "difficulty": "advanced",
      "question": "External validation of a high-discrimination binary model. Expected C-statistic = 0.90 in validation cohort. Outcome prevalence = 30%. LP follows a normal distribution with mean = -0.5 and SD = 4.0 (note: SD, not variance). We want very precise C-statistic estimation: CI width \u2264 0.05. Calibration slope CI width \u2264 0.20, O/E CI width \u2264 0.20. Use pmvalsampsize(type='b', prevalence=0.30, cstatistic=0.90, lpnormal=c(-0.5, 4.0), cstatciwidth=0.05, csciwidth=0.2, oeciwidth=0.2). What is the minimum sample size?",
      "expected_template": "riley_validation",
      "ground_truth": {
        "sample_size": 1674,
        "events": 503,
        "prevalence": 0.30,
        "cstatistic": 0.90,
        "cstat_ciwidth": 0.05,
        "calslope_ciwidth": 0.20,
        "oe_ciwidth": 0.20,
        "binding_criterion": "calibration_slope",
        "criteria": "pmvalsampsize_binary"
      },
      "tolerance": {
        "sample_size": 84,
        "events": 25
      },
      "source": "pmvalsampsize (R-validated 2026-02-01)",
      "reference_code": "library(pmvalsampsize)\n# lpnormal takes (mean, SD) — here SD=4.0\npmvalsampsize(type='b', prevalence=0.30, cstatistic=0.90, lpnormal=c(-0.5, 4.0), cstatciwidth=0.05, csciwidth=0.2, oeciwidth=0.2)\n# Criteria 1 (O/E): 898, Criteria 2 (C-slope): 1674, Criteria 3 (C-stat): 746\n# Final: 1674 (calibration slope binds)"
    },
    {
      "id": "t4-valid-004",
      "template": "external_validation",
      "difficulty": "intermediate",
      "question": "External validation with Beta-distributed linear predictor. Expected C-statistic = 0.75, prevalence = 15%. The predicted probabilities follow a Beta(2, 5) distribution. Use pmvalsampsize(type='b', prevalence=0.15, cstatistic=0.75, lpbeta=c(2, 5), cstatciwidth=0.1, csciwidth=0.2, oeciwidth=0.2). What is the minimum sample size?",
      "expected_template": "riley_validation",
      "ground_truth": {
        "sample_size": 3733,
        "events": 560,
        "prevalence": 0.15,
        "cstatistic": 0.75,
        "cstat_ciwidth": 0.10,
        "calslope_ciwidth": 0.20,
        "oe_ciwidth": 0.20,
        "lp_distribution": "beta(2,5)",
        "binding_criterion": "calibration_slope",
        "criteria": "pmvalsampsize_binary"
      },
      "tolerance": {
        "sample_size": 187,
        "events": 28
      },
      "source": "pmvalsampsize (R-validated 2026-02-01)",
      "reference_code": "library(pmvalsampsize)\npmvalsampsize(type='b', prevalence=0.15, cstatistic=0.75, lpbeta=c(2, 5), cstatciwidth=0.1, csciwidth=0.2, oeciwidth=0.2)\n# Criteria 1 (O/E): 2179, Criteria 2 (C-slope): 3733, Criteria 3 (C-stat): 712\n# Final: 3733 (calibration slope binds)"
    },
    {
      "id": "t4-valid-005",
      "template": "external_validation",
      "difficulty": "basic",
      "question": "Simple external validation: only need C-statistic precision. DVT model with LP normal distribution: mean=-1.75, SD=2.16 (note: SD, not variance). C=0.82, prevalence=0.22. We want wider (relaxed) CI targets: C-stat CI width \u2264 0.10, calibration slope CI width \u2264 0.30, O/E CI width \u2264 0.30. Use pmvalsampsize(type='b', prevalence=0.22, cstatistic=0.82, lpnormal=c(-1.75, 2.16), cstatciwidth=0.1, csciwidth=0.3, oeciwidth=0.3). What is the minimum sample size?",
      "expected_template": "riley_validation",
      "ground_truth": {
        "sample_size": 814,
        "events": 180,
        "prevalence": 0.22,
        "cstatistic": 0.82,
        "cstat_ciwidth": 0.10,
        "calslope_ciwidth": 0.30,
        "oe_ciwidth": 0.30,
        "binding_criterion": "calibration_slope",
        "criteria": "pmvalsampsize_binary"
      },
      "tolerance": {
        "sample_size": 41,
        "events": 9
      },
      "source": "pmvalsampsize (R-validated 2026-02-01)",
      "reference_code": "library(pmvalsampsize)\n# lpnormal takes (mean, SD) — here SD=2.16\npmvalsampsize(type='b', prevalence=0.22, cstatistic=0.82, lpnormal=c(-1.75, 2.16), cstatciwidth=0.1, csciwidth=0.3, oeciwidth=0.3)\n# Criteria 1 (O/E): 610, Criteria 2 (C-slope): 814, Criteria 3 (C-stat): 400\n# Final: 814 (calibration slope binds)"
    },
    {
      "id": "t4-valid-006",
      "template": "external_validation",
      "difficulty": "advanced",
      "question": "External validation with net benefit assessment. Binary model for cancer screening decisions. Expected C-statistic = 0.80, prevalence = 10%, LP follows a normal distribution with mean = -3.0 and SD = 2.25 (note: SD, not variance). We need precision for: C-stat CI width \u2264 0.10, calibration slope CI width \u2264 0.20, O/E CI width \u2264 0.20. Additionally, at a treatment threshold of 10%, we expect sensitivity = 0.80, specificity = 0.70, and want standardized net benefit CI width \u2264 0.20. Use pmvalsampsize(type='b', prevalence=0.10, cstatistic=0.80, lpnormal=c(-3.0, 2.25), cstatciwidth=0.1, csciwidth=0.2, oeciwidth=0.2, sensitivity=0.80, specificity=0.70, threshold=0.10, nbciwidth=0.2). What is the minimum sample size?",
      "expected_template": "riley_validation",
      "ground_truth": {
        "sample_size": 3461,
        "events": 347,
        "prevalence": 0.10,
        "cstatistic": 0.80,
        "cstat_ciwidth": 0.10,
        "calslope_ciwidth": 0.20,
        "oe_ciwidth": 0.20,
        "threshold": 0.10,
        "sensitivity": 0.80,
        "specificity": 0.70,
        "nb_ciwidth": 0.20,
        "binding_criterion": "oe_ratio",
        "criteria": "pmvalsampsize_binary_netbenefit"
      },
      "tolerance": {
        "sample_size": 173,
        "events": 17
      },
      "source": "pmvalsampsize (R-validated 2026-02-01)",
      "reference_code": "library(pmvalsampsize)\n# lpnormal takes (mean, SD) — here SD=2.25\npmvalsampsize(type='b', prevalence=0.10, cstatistic=0.80, lpnormal=c(-3.0, 2.25), cstatciwidth=0.1, csciwidth=0.2, oeciwidth=0.2, sensitivity=0.80, specificity=0.70, threshold=0.10, nbciwidth=0.2)\n# Criteria 1 (O/E): 3461, Criteria 2 (C-slope): 2435, Criteria 3 (C-stat): 836, Criteria 4 (St NB): 1090\n# Final: 3461 (O/E criterion binds)"
    },
    {
      "id": "t4-valid-007",
      "template": "external_validation",
      "difficulty": "basic",
      "question": "External validation of existing binary prediction model. Original C-statistic 0.80, expect 0.75 in new population. Outcome prevalence 12%. What sample size for precise C-statistic estimation (95% CI width \u2264 0.10)? Use the Hanley-McNeil (1982) variance formula: Q1=C/(2-C), Q2=2C\u00b2/(1+C), Var(C)=[(Q1-C\u00b2)/(N*(1-p)) + (Q2-C\u00b2)/(N*p)], then find minimum N such that 2*qnorm(0.975)*sqrt(Var(C)) \u2264 0.10.",
      "expected_template": "riley_validation",
      "ground_truth": {
        "sample_size": 1100,
        "events": 132,
        "expected_c_statistic": 0.75,
        "prevalence": 0.12,
        "ci_width": 0.1,
        "criteria": "hanley_mcneil_validation"
      },
      "tolerance": {
        "sample_size": 55,
        "events": 7
      },
      "source": "Hanley-McNeil (1982) variance formula (verified 2026-01-29)",
      "reference_code": "C <- 0.75; p <- 0.12; w <- 0.10; z <- qnorm(0.975)\nQ1 <- C/(2-C); Q2 <- 2*C^2/(1+C)\nse <- w/(2*z)\nvar_coeff <- (Q1-C^2)/(1-p) + (Q2-C^2)/p\nN <- ceiling(var_coeff/se^2)  # = 1100"
    }
  ]
}
